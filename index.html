<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>333</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #000000 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            overflow: hidden;
            position: relative;
            padding: 20px;
        }

        /* Animated background particles */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.05) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.03) 0%, transparent 50%),
                        radial-gradient(circle at 40% 40%, rgba(255, 255, 255, 0.02) 0%, transparent 50%);
            animation: backgroundShift 20s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes backgroundShift {
            0%, 100% { transform: translateX(0) translateY(0) rotate(0deg); }
            25% { transform: translateX(-20px) translateY(-10px) rotate(1deg); }
            50% { transform: translateX(20px) translateY(10px) rotate(-1deg); }
            75% { transform: translateX(-10px) translateY(20px) rotate(0.5deg); }
        }

        /* Floating particles */
        .particles {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            animation: float 15s infinite linear;
        }

        .particle:nth-child(1) { width: 4px; height: 4px; left: 10%; animation-delay: 0s; }
        .particle:nth-child(2) { width: 6px; height: 6px; left: 20%; animation-delay: 2s; }
        .particle:nth-child(3) { width: 3px; height: 3px; left: 30%; animation-delay: 4s; }
        .particle:nth-child(4) { width: 5px; height: 5px; left: 40%; animation-delay: 6s; }
        .particle:nth-child(5) { width: 4px; height: 4px; left: 50%; animation-delay: 8s; }
        .particle:nth-child(6) { width: 7px; height: 7px; left: 60%; animation-delay: 10s; }
        .particle:nth-child(7) { width: 3px; height: 3px; left: 70%; animation-delay: 12s; }
        .particle:nth-child(8) { width: 5px; height: 5px; left: 80%; animation-delay: 14s; }
        .particle:nth-child(9) { width: 4px; height: 4px; left: 90%; animation-delay: 16s; }

        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }

        .player-container {
            display: flex;
            gap: 40px;
            width: 100%;
            max-width: 1200px;
            align-items: center;
            justify-content: center;
            animation: slideInUp 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .music-player {
            background: transparent;
            backdrop-filter: none;
            border-radius: 0;
            padding: 20px;
            width: 400px;
            flex-shrink: 0;
            box-shadow: none;
            border: none;
            position: relative;
            transform-origin: center bottom;
        }

        .song-sidebar {
            background: rgba(128, 128, 128, 0.3);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            width: 300px;
            flex-shrink: 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            height: 500px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transform: perspective(1000px) rotateY(-10deg);
            transform-origin: left center;
        }

        @keyframes slideInUp {
            0% {
                opacity: 0;
                transform: translateY(50px) scale(0.9);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Glowing border effect */
        .song-sidebar::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #ffffff, #cccccc, #ffffff, #cccccc, #ffffff);
            border-radius: 17px;
            z-index: -1;
            opacity: 0;
            animation: borderGlow 3s ease-in-out infinite;
        }

        @keyframes borderGlow {
            0%, 100% { opacity: 0; }
            50% { opacity: 0.2; }
        }

        .album-art {
            width: 220px;
            height: 220px;
            border-radius: 20px;
            margin: 0 auto 25px;
            background: linear-gradient(45deg, #ffffff, #f0f0f0);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 70px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.6), 
                        0 0 0 1px rgba(255, 255, 255, 0.2);
            overflow: hidden;
            position: relative;
            animation: albumArtFloat 6s ease-in-out infinite;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes albumArtFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(2deg); }
        }

        .album-art:hover {
            transform: scale(1.05) rotate(5deg);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.8), 
                        0 0 0 1px rgba(255, 255, 255, 0.3);
        }

        .album-art::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .album-art:hover::before {
            transform: translateX(100%);
        }

        .album-art img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 15px;
        }

        .album-art .default-icon {
            opacity: 0.7;
        }

        .track-info {
            text-align: center;
            margin-bottom: 35px;
            animation: fadeInUp 0.6s ease-out 0.2s both;
        }

        @keyframes fadeInUp {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .track-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 12px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            background: linear-gradient(45deg, #ffffff, #cccccc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: textGlow 3s ease-in-out infinite;
        }

        @keyframes textGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .track-artist {
            font-size: 17px;
            opacity: 0.9;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .track-artist:hover {
            opacity: 1;
            transform: scale(1.05);
        }

        .track-album {
            font-size: 15px;
            opacity: 0.7;
            transition: all 0.3s ease;
        }

        .track-album:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }

        .progress-container {
            margin-bottom: 25px;
            animation: fadeInUp 0.6s ease-out 0.4s both;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .progress-bar:hover {
            height: 12px;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3), inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, #ffffff, #cccccc, #ffffff);
            border-radius: 10px;
            width: 0%;
            transition: width 0.1s ease;
            position: relative;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.6);
        }

        .progress::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: progressShine 2s ease-in-out infinite;
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .time-info {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            opacity: 0.7;
            margin-top: 8px;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 25px;
            margin-bottom: 25px;
            animation: fadeInUp 0.6s ease-out 0.6s both;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            color: white;
            font-size: 22px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .control-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .control-btn:hover::before {
            transform: translateX(100%);
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.15) translateY(-2px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.6), 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .control-btn:active {
            transform: scale(1.05) translateY(0px);
        }

        .play-btn {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #ffffff, #cccccc);
            font-size: 30px;
            box-shadow: 0 10px 25px rgba(255, 255, 255, 0.3);
            animation: playButtonPulse 2s ease-in-out infinite;
        }

        @keyframes playButtonPulse {
            0%, 100% { box-shadow: 0 10px 25px rgba(255, 255, 255, 0.3); }
            50% { box-shadow: 0 15px 35px rgba(255, 255, 255, 0.5); }
        }

        .play-btn:hover {
            transform: scale(1.2) translateY(-3px);
            box-shadow: 0 15px 35px rgba(255, 255, 255, 0.6), 0 0 30px rgba(255, 255, 255, 0.4);
        }

        .volume-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            animation: fadeInUp 0.6s ease-out 0.8s both;
        }

        .volume-slider {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            outline: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .volume-slider:hover {
            height: 8px;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3), inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .volume-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(45deg, #ffffff, #cccccc);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.4);
            transition: all 0.3s ease;
        }

        .volume-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 6px 16px rgba(255, 255, 255, 0.6), 0 0 20px rgba(255, 255, 255, 0.4);
        }

        .sidebar-header {
            margin-bottom: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 10px;
        }

        .sidebar-title {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
            font-family: 'Courier New', monospace;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .sidebar-subtitle {
            font-size: 11px;
            opacity: 0.8;
            font-family: 'Courier New', monospace;
            color: #ccc;
        }

        .song-list {
            flex: 1;
            overflow-y: auto;
            background: transparent;
            border-radius: 0;
            padding: 0;
            backdrop-filter: none;
            border: none;
            font-family: 'Courier New', monospace;
            /* Hide scrollbar */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* Internet Explorer 10+ */
        }

        .song-list::-webkit-scrollbar {
            display: none; /* WebKit browsers (Chrome, Safari, Edge) */
        }

        .song-item {
            padding: 8px 0;
            border-radius: 0;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 2px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 8px;
            border-left: 2px solid transparent;
            font-family: 'Courier New', monospace;
            justify-content: space-between;
        }

        .song-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-left: 2px solid #ffffff;
            color: #ffffff;
        }

        .song-item.active {
            background: rgba(255, 255, 255, 0.2);
            border-left: 2px solid #ffffff;
            color: #ffffff;
        }

        .song-number {
            font-size: 11px;
            opacity: 0.7;
            min-width: 25px;
            text-align: right;
            color: #888;
            font-family: 'Courier New', monospace;
        }

        .song-info {
            flex: 1;
            min-width: 0;
        }

        .song-name {
            font-size: 12px;
            font-weight: normal;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 0;
            font-family: 'Courier New', monospace;
            color: #ccc;
        }

        .song-duration {
            font-size: 10px;
            color: #888;
            opacity: 0.8;
            font-family: 'Courier New', monospace;
        }

        .playlist {
            display: none;
        }

        .playlist-item {
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
        }

        .playlist-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s;
        }

        .playlist-item:hover::before {
            left: 100%;
        }

        .playlist-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px) scale(1.02);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }

        .playlist-item.active {
            background: linear-gradient(45deg, #ffffff, #cccccc);
            transform: translateX(8px) scale(1.05);
            box-shadow: 0 8px 20px rgba(255, 255, 255, 0.3);
        }

        .playlist-item img {
            width: 40px;
            height: 40px;
            border-radius: 5px;
            object-fit: cover;
        }

        .playlist-info {
            flex: 1;
        }

        .playlist-title {
            font-size: 14px;
            font-weight: 500;
        }

        .playlist-artist {
            font-size: 12px;
            opacity: 0.7;
        }

        .file-input {
            display: none;
        }

        .directory-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 15px;
            padding: 15px 25px;
            color: white;
            cursor: pointer;
            margin-bottom: 25px;
            width: 100%;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 16px;
            font-weight: 600;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            animation: fadeInUp 0.6s ease-out 0.1s both;
        }

        .directory-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }

        .directory-btn:hover::before {
            left: 100%;
        }

        .directory-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.6);
        }

        .directory-btn:active {
            transform: translateY(-1px) scale(1.01);
        }

        .loading {
            text-align: center;
            opacity: 0.8;
            font-style: italic;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .error {
            color: #ff6b6b;
            text-align: center;
            margin: 15px 0;
            padding: 10px;
            background: rgba(255, 107, 107, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 107, 107, 0.3);
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .spinning {
            animation: spin 2s linear infinite;
        }

        /* Track change animation */
        .track-changing {
            animation: trackChange 0.5s ease-in-out;
        }

        @keyframes trackChange {
            0% { opacity: 0.5; transform: scale(0.95); }
            50% { opacity: 0.8; transform: scale(1.02); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* Custom scrollbar */
        .playlist::-webkit-scrollbar,
        .song-list::-webkit-scrollbar {
            width: 6px;
        }

        .playlist::-webkit-scrollbar-track,
        .song-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .playlist::-webkit-scrollbar-thumb,
        .song-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        .playlist::-webkit-scrollbar-thumb:hover,
        .song-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* Responsive design */
        @media (max-width: 1024px) {
            .player-container {
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }
            
            .music-player {
                width: 100%;
                max-width: 400px;
            }
            
            .song-sidebar {
                width: 100%;
                max-width: 400px;
                height: 400px;
                transform: none;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .player-container {
                gap: 15px;
            }
            
            .music-player {
                padding: 15px;
            }
            
            .song-sidebar {
                padding: 15px;
                height: 300px;
            }
            
            .album-art {
                width: 180px;
                height: 180px;
                font-size: 60px;
            }
        }
    </style>
</head>
<body>
    <!-- Floating particles background -->
    <div class="particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <div class="player-container">
        <div class="music-player">
        <div class="album-art" id="albumArt">
            <img src="./cover.webp" alt="Album Cover" style="width: 100%; height: 100%; object-fit: cover; border-radius: 20px;">
        </div>

        <div class="track-info">
            <div class="track-title" id="trackTitle">Loading music...</div>
            <div class="track-artist" id="trackArtist">Please wait</div>
            <div class="track-album" id="trackAlbum">Loading from directory</div>
        </div>

        <div class="progress-container">
            <div class="progress-bar" id="progressBar">
                <div class="progress" id="progress"></div>
            </div>
            <div class="time-info">
                <span id="currentTime">0:00</span>
                <span id="duration">0:00</span>
            </div>
        </div>

        <div class="controls">
            <button class="control-btn" onclick="previousTrack()">⏮</button>
            <button class="control-btn play-btn" id="playBtn" onclick="togglePlay()">▶</button>
            <button class="control-btn" onclick="nextTrack()">⏭</button>
        </div>

        <div class="volume-container">
            <span>🔉</span>
            <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="70">
            <span>🔊</span>
        </div>

        <div class="playlist" id="playlist">
            <div class="loading">Loading music files from /music directory...</div>
        </div>
        </div>

        <div class="song-sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">Music Directory</div>
                <div class="sidebar-subtitle" id="songCount">Loading files...</div>
            </div>
            <div class="song-list" id="songList">
                <div class="loading">Loading music files...</div>
            </div>
        </div>
    </div>

    <script>
        class MusicPlayer {
            constructor() {
                this.audio = new Audio();
                this.playlist = [];
                this.currentTrackIndex = 0;
                this.isPlaying = false;
                this.isLoading = false;
                
                this.initializeEventListeners();
                this.setupAudioElement();
                this.loadMusicFromDirectory();
            }

            initializeEventListeners() {
                // Volume control
                document.getElementById('volumeSlider').addEventListener('input', (e) => {
                    this.audio.volume = e.target.value / 100;
                });

                // Progress bar click
                document.getElementById('progressBar').addEventListener('click', (e) => {
                    if (this.audio.duration) {
                        const rect = e.target.getBoundingClientRect();
                        const clickX = e.clientX - rect.left;
                        const percentage = clickX / rect.width;
                        this.audio.currentTime = percentage * this.audio.duration;
                    }
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    switch(e.code) {
                        case 'Space':
                            e.preventDefault();
                            this.togglePlay();
                            break;
                        case 'ArrowLeft':
                            this.previousTrack();
                            break;
                        case 'ArrowRight':
                            this.nextTrack();
                            break;
                        case 'ArrowUp':
                            this.increaseVolume();
                            break;
                        case 'ArrowDown':
                            this.decreaseVolume();
                            break;
                    }
                });
            }

            setupAudioElement() {
                this.audio.addEventListener('timeupdate', () => {
                    this.updateProgress();
                });

                this.audio.addEventListener('loadedmetadata', () => {
                    this.updateDuration();
                });

                this.audio.addEventListener('ended', () => {
                    this.nextTrack();
                });

                this.audio.addEventListener('error', (e) => {
                    console.error('Audio error:', e);
                    this.showError('Error loading audio file');
                });

                // Set initial volume
                this.audio.volume = 0.7;
            }

            async loadMusicFromDirectory() {
                try {
                    console.log('Loading music from directory...');
                    // Try to load music files from the /music directory
                    const response = await fetch('./');
                    if (!response.ok) {
                        throw new Error('Music directory not found');
                    }
                    
                    const html = await response.text();
                    console.log('Music directory HTML:', html);
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const links = doc.querySelectorAll('a[href]');
                    console.log('Found links:', links.length);
                    
                    const audioFiles = Array.from(links)
                        .map(link => link.getAttribute('href'))
                        .filter(href => {
                            if (!href) return false;
                            const ext = href.toLowerCase().split('.').pop();
                            return ['mp3', 'wav', 'flac', 'aac', 'm4a', 'ogg', 'wma'].includes(ext);
                        })
                        .map(href => new URL('./' + href, window.location.origin).href);
                    
                    console.log('Audio files found:', audioFiles);
                    
                    if (audioFiles.length === 0) {
                        this.showError('No audio files found in directory');
                        return;
                    }
                    
                    this.loadMusicFilesFromUrls(audioFiles);
                } catch (error) {
                    console.error('Error loading music directory:', error);
                    this.showError('Could not load music from directory. Please run the Python server: python start_server.py');
                }
            }

            createFilePicker() {
                const input = document.createElement('input');
                input.type = 'file';
                input.webkitdirectory = true;
                input.multiple = true;
                input.accept = 'audio/*';
                input.style.display = 'none';
                
                input.onchange = (e) => {
                    const files = Array.from(e.target.files);
                    this.loadMusicFiles(files);
                };
                
                // Auto-trigger the file picker
                setTimeout(() => {
                    input.click();
                }, 1000);
            }

            async loadMusicFilesFromUrls(audioUrls) {
                this.isLoading = true;
                this.showLoading();
                
                try {
                    console.log('Loading music files from URLs:', audioUrls);
                    this.playlist = await Promise.all(
                        audioUrls.map(async (url) => {
                            const filename = decodeURIComponent(url.split('/').pop());
                            console.log('Processing file:', filename);
                            const metadata = await this.extractMetadataFromUrl(url);
                            return {
                                url: url,
                                title: metadata.title || this.getTitleFromFilename(filename),
                                artist: 'Bladee',
                                album: '333',
                                albumArt: './cover.webp',
                                duration: metadata.duration || 0
                            };
                        })
                    );

                    console.log('Playlist loaded:', this.playlist);
                    
                    // Sort playlist according to the specified order
                    const songOrder = [
                        'Wings in Motion',
                        'Don\'t Worry',
                        'Keys to the City',
                        'Hero of My Story 3style3',
                        '100s',
                        'Mean Girls',
                        'Innocent of All Things',
                        'Reality Surf',
                        'Noblest Strive',
                        'It Girl',
                        'Oh Well',
                        'Valerie',
                        'Finder',
                        'Exstasia',
                        'Only One',
                        'Swan Lake'
                    ];
                    
                    this.playlist.sort((a, b) => {
                        const indexA = songOrder.indexOf(a.title);
                        const indexB = songOrder.indexOf(b.title);
                        return indexA - indexB;
                    });
                    
                    console.log('Playlist sorted:', this.playlist);
                    this.renderPlaylist();
                    this.loadTrack(0);
                    this.hideLoading();
                } catch (error) {
                    console.error('Error loading music files:', error);
                    this.showError('Error loading music files');
                }
            }

            async loadMusicFiles(files) {
                this.isLoading = true;
                this.showLoading();
                
                try {
                    // Filter audio files
                    const audioFiles = files.filter(file => 
                        file.type.startsWith('audio/') && 
                        !file.name.startsWith('.')
                    );

                    if (audioFiles.length === 0) {
                        this.showError('No audio files found in the selected directory');
                        return;
                    }

                    this.playlist = await Promise.all(
                        audioFiles.map(async (file) => {
                            const metadata = await this.extractMetadata(file);
                            return {
                                file: file,
                                url: URL.createObjectURL(file),
                                title: metadata.title || this.getTitleFromFilename(file.name),
                                artist: 'Bladee',
                                album: '333',
                                albumArt: './cover.webp',
                                duration: metadata.duration || 0
                            };
                        })
                    );

                    this.renderPlaylist();
                    this.loadTrack(0);
                    this.hideLoading();
                } catch (error) {
                    console.error('Error loading music files:', error);
                    this.showError('Error loading music files');
                }
            }

            async extractMetadataFromUrl(url) {
                return new Promise((resolve) => {
                    const audio = new Audio();
                    
                    audio.addEventListener('loadedmetadata', () => {
                        resolve({
                            title: this.getTitleFromFilename(url.split('/').pop()),
                            artist: 'Unknown Artist',
                            album: 'Unknown Album',
                            duration: audio.duration,
                            albumArt: null
                        });
                    });

                    audio.addEventListener('error', () => {
                        resolve({
                            title: this.getTitleFromFilename(url.split('/').pop()),
                            artist: 'Unknown Artist',
                            album: 'Unknown Album',
                            duration: 0,
                            albumArt: null
                        });
                    });

                    audio.src = url;
                });
            }

            async extractMetadata(file) {
                return new Promise((resolve) => {
                    const audio = new Audio();
                    const url = URL.createObjectURL(file);
                    
                    audio.addEventListener('loadedmetadata', () => {
                        resolve({
                            title: this.getTitleFromFilename(file.name),
                            artist: 'Unknown Artist',
                            album: 'Unknown Album',
                            duration: audio.duration,
                            albumArt: null
                        });
                        URL.revokeObjectURL(url);
                    });

                    audio.addEventListener('error', () => {
                        resolve({
                            title: this.getTitleFromFilename(file.name),
                            artist: 'Unknown Artist',
                            album: 'Unknown Album',
                            duration: 0,
                            albumArt: null
                        });
                        URL.revokeObjectURL(url);
                    });

                    audio.src = url;
                });
            }

            getTitleFromFilename(filename) {
                // Decode URL encoding and clean up the filename
                const decoded = decodeURIComponent(filename);
                const withoutExt = decoded.replace(/\.[^/.]+$/, "");
                const withoutBladee = withoutExt.replace(/^Bladee\s*-\s*/i, "");
                return withoutBladee.trim();
            }

            renderPlaylist() {
                const playlistElement = document.getElementById('playlist');
                playlistElement.innerHTML = '';

                this.playlist.forEach((track, index) => {
                    const item = document.createElement('div');
                    item.className = 'playlist-item';
                    if (index === this.currentTrackIndex) {
                        item.classList.add('active');
                    }

                    // Add staggered animation delay
                    item.style.animationDelay = `${index * 0.1}s`;
                    item.style.opacity = '0';
                    item.style.transform = 'translateY(20px)';

                    item.innerHTML = `
                        <img src="${track.albumArt || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBmaWxsPSIjRkY2QjZCIi8+CjxwYXRoIGQ9Ik0xNiAxMkwyNCAyMEwxNiAyOFYxMloiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo='}" alt="Album Art">
                        <div class="playlist-info">
                            <div class="playlist-title">${track.title}</div>
                            <div class="playlist-artist">${track.artist}</div>
                        </div>
                    `;

                    item.addEventListener('click', () => {
                        this.loadTrack(index);
                    });

                    playlistElement.appendChild(item);

                    // Animate in
                    setTimeout(() => {
                        item.style.transition = 'all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                        item.style.opacity = '1';
                        item.style.transform = 'translateY(0)';
                    }, index * 50);
                });

                // Also render the sidebar
                this.renderSidebar();
            }

            renderSidebar() {
                const songListElement = document.getElementById('songList');
                const songCountElement = document.getElementById('songCount');
                
                songListElement.innerHTML = '';
                songCountElement.textContent = `${this.playlist.length} files loaded`;

                this.playlist.forEach((track, index) => {
                    const item = document.createElement('div');
                    item.className = 'song-item';
                    if (index === this.currentTrackIndex) {
                        item.classList.add('active');
                    }

                    // Simple command-line style
                    const duration = this.formatTime(track.duration);
                    item.innerHTML = `
                        <div class="song-number">${String(index + 1).padStart(2, '0')}</div>
                        <div class="song-info">
                            <div class="song-name">${track.title}</div>
                        </div>
                        <div class="song-duration">${duration}</div>
                    `;

                    item.addEventListener('click', () => {
                        this.loadTrack(index);
                    });

                    songListElement.appendChild(item);
                });
            }

            loadTrack(index) {
                if (index < 0 || index >= this.playlist.length) return;

                this.currentTrackIndex = index;
                const track = this.playlist[index];

                this.audio.src = track.url;
                this.updateTrackInfo(track);
                this.updatePlaylistUI();
                
                if (this.isPlaying) {
                    this.audio.play();
                }
            }

            updateTrackInfo(track) {
                // Add track change animation
                const trackInfo = document.querySelector('.track-info');
                trackInfo.classList.add('track-changing');
                
                setTimeout(() => {
                    document.getElementById('trackTitle').textContent = track.title;
                    document.getElementById('trackArtist').textContent = track.artist;
                    document.getElementById('trackAlbum').textContent = track.album;

                    const albumArtElement = document.getElementById('albumArt');
                    if (track.albumArt) {
                        albumArtElement.innerHTML = `<img src="${track.albumArt}" alt="Album Art">`;
                    } else {
                        albumArtElement.innerHTML = '<img src="./cover.webp" alt="Album Cover" style="width: 100%; height: 100%; object-fit: cover; border-radius: 20px;">';
                    }
                    
                    trackInfo.classList.remove('track-changing');
                }, 250);
            }

            updatePlaylistUI() {
                const playlistItems = document.querySelectorAll('.playlist-item');
                const sidebarItems = document.querySelectorAll('.song-item');
                
                playlistItems.forEach((item, index) => {
                    item.classList.toggle('active', index === this.currentTrackIndex);
                });
                
                sidebarItems.forEach((item, index) => {
                    item.classList.toggle('active', index === this.currentTrackIndex);
                });
            }

            togglePlay() {
                if (this.playlist.length === 0) return;

                if (this.isPlaying) {
                    this.audio.pause();
                    document.getElementById('playBtn').textContent = '▶';
                } else {
                    this.audio.play();
                    document.getElementById('playBtn').textContent = '⏸';
                }
                this.isPlaying = !this.isPlaying;
            }

            previousTrack() {
                if (this.playlist.length === 0) return;
                const prevIndex = this.currentTrackIndex > 0 ? 
                    this.currentTrackIndex - 1 : this.playlist.length - 1;
                this.loadTrack(prevIndex);
            }

            nextTrack() {
                if (this.playlist.length === 0) return;
                const nextIndex = this.currentTrackIndex < this.playlist.length - 1 ? 
                    this.currentTrackIndex + 1 : 0;
                this.loadTrack(nextIndex);
            }

            increaseVolume() {
                const volumeSlider = document.getElementById('volumeSlider');
                const newVolume = Math.min(100, parseInt(volumeSlider.value) + 10);
                volumeSlider.value = newVolume;
                this.audio.volume = newVolume / 100;
            }

            decreaseVolume() {
                const volumeSlider = document.getElementById('volumeSlider');
                const newVolume = Math.max(0, parseInt(volumeSlider.value) - 10);
                volumeSlider.value = newVolume;
                this.audio.volume = newVolume / 100;
            }

            updateProgress() {
                if (this.audio.duration) {
                    const progress = (this.audio.currentTime / this.audio.duration) * 100;
                    document.getElementById('progress').style.width = progress + '%';
                    document.getElementById('currentTime').textContent = this.formatTime(this.audio.currentTime);
                }
            }

            updateDuration() {
                document.getElementById('duration').textContent = this.formatTime(this.audio.duration);
            }

            formatTime(seconds) {
                if (isNaN(seconds)) return '0:00';
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            }

            showLoading() {
                document.getElementById('playlist').innerHTML = '<div class="loading spinning">Loading music files...</div>';
                document.getElementById('songList').innerHTML = '<div class="loading spinning">Loading music files...</div>';
                document.getElementById('songCount').textContent = 'Loading songs...';
            }

            hideLoading() {
                // Loading will be replaced by renderPlaylist()
            }

            showError(message) {
                document.getElementById('playlist').innerHTML = `<div class="error">${message}</div>`;
                document.getElementById('songList').innerHTML = `<div class="error">${message}</div>`;
                document.getElementById('songCount').textContent = 'Error loading songs';
            }
        }

        // Initialize the music player
        const player = new MusicPlayer();

        // Global functions for HTML onclick events
        function togglePlay() {
            player.togglePlay();
        }

        function previousTrack() {
            player.previousTrack();
        }

        function nextTrack() {
            player.nextTrack();
        }

        function increaseVolume() {
            player.increaseVolume();
        }

        function decreaseVolume() {
            player.decreaseVolume();
        }
    </script>
</body>
</html>
